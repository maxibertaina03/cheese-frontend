{"ast":null,"code":"import _objectSpread from\"C:/Users/Usuario/Desktop/cheese-stock-system/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// App.tsx\nimport React,{useState,useEffect}from'react';import'./App.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL;const Login=_ref=>{let{onLogin}=_ref;const[username,setUsername]=useState('');const[password,setPassword]=useState('');const handleLogin=async()=>{try{const res=await fetch(\"\".concat(process.env.REACT_APP_API_URL,\"/api/auth/login\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});const data=await res.json();if(res.ok){onLogin({token:data.token,rol:data.rol});}else{alert('Credenciales inv√°lidas');}}catch(err){alert('Error de conexi√≥n');}};return/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:400,margin:'100px auto',padding:'2rem',border:'1px solid #ccc',borderRadius:8},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Iniciar sesi\\xF3n\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Usuario\",value:username,onChange:e=>setUsername(e.target.value),style:{width:'100%',marginBottom:'1rem',padding:'0.5rem'}}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Contrase\\xF1a\",value:password,onChange:e=>setPassword(e.target.value),style:{width:'100%',marginBottom:'1rem',padding:'0.5rem'}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogin,style:{width:'100%',padding:'0.5rem'},children:\"Entrar\"})]});};function App(){var _decodificarBarcode;const[user,setUser]=useState(null);const[unidades,setUnidades]=useState([]);const[productos,setProductos]=useState([]);const[tiposQueso,setTiposQueso]=useState([]);const[showForm,setShowForm]=useState(false);const[error,setError]=useState('');const[success,setSuccess]=useState('');const[loading,setLoading]=useState(false);// Form state\nconst[codigoBarras,setCodigoBarras]=useState('');const[productoSeleccionado,setProductoSeleccionado]=useState(null);const[observacionesIngreso,setObservacionesIngreso]=useState('');const[observacionesCorte,setObservacionesCorte]=useState('');const[codigoBarrasCorte,setCodigoBarrasCorte]=useState('');// Agregar estos estados al inicio del componente\nconst[filtroInventario,setFiltroInventario]=useState('');const[busquedaObservaciones,setBusquedaObservaciones]=useState(false);// Historial state\nconst[showHistorial,setShowHistorial]=useState(false);const[historialUnidades,setHistorialUnidades]=useState([]);const[filtroHistorial,setFiltroHistorial]=useState('todos');const[busquedaHistorial,setBusquedaHistorial]=useState('');// Modal state\nconst[showCutModal,setShowCutModal]=useState(false);const[unidadParaCortar,setUnidadParaCortar]=useState(null);const[pesoCorte,setPesoCorte]=useState('');const[showEditModal,setShowEditModal]=useState(false);const[unidadParaEditar,setUnidadParaEditar]=useState(null);// Agregar estos estados\nconst[fechaInicio,setFechaInicio]=useState('');const[fechaFin,setFechaFin]=useState('');const[tipoQuesoFiltro,setTipoQuesoFiltro]=useState('todos');const[precios,setPrecios]=useState({});// productoId -> precio\n//estados de motivos\nconst[motivos,setMotivos]=useState([]);const[motivoIngresoId,setMotivoIngresoId]=useState(null);const[motivoCorteId,setMotivoCorteId]=useState(null);const[dataLoaded,setDataLoaded]=useState(false);useEffect(()=>{if(user!==null&&user!==void 0&&user.token&&!dataLoaded){fetchData();setDataLoaded(true);}},[user,dataLoaded]);const fetchMotivos=async()=>{try{const response=await apiFetch(\"\".concat(API_URL,\"/api/motivos\"));const data=await response.json();setMotivos(data);}catch(error){console.error('Error al cargar motivos:',error);}};const fetchData=async()=>{await Promise.all([fetchUnidades(),fetchProductos(),fetchTiposQueso(),fetchMotivos()]);};const fetchUnidades=async()=>{try{const response=await apiFetch(\"\".concat(API_URL,\"/api/unidades\"));const data=await response.json();setUnidades(data);}catch(error){console.error('Error al cargar unidades:',error);}};const fetchProductos=async()=>{try{console.log(\"Token en fetchProductos:\",user===null||user===void 0?void 0:user.token);// üëà esto\nconst response=await apiFetch(\"\".concat(API_URL,\"/api/productos\"));const data=await response.json();console.log(\"Productos recibidos:\",data);// üëà y esto\nsetProductos(data);}catch(error){console.error('Error al cargar productos:',error);}};const fetchHistorial=async()=>{try{const response=await apiFetch(\"\".concat(API_URL,\"/api/unidades/historial\"));const data=await response.json();setHistorialUnidades(data);}catch(error){console.error('Error al cargar historial:',error);}};const fetchTiposQueso=async()=>{try{const response=await apiFetch(\"\".concat(API_URL,\"/api/tipos-queso\"));const data=await response.json();setTiposQueso(data);}catch(error){console.error('Error al cargar tipos de queso:',error);}};// Helper para hacer fetch con token\nconst apiFetch=function(url){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return fetch(url,_objectSpread(_objectSpread({},options),{},{headers:_objectSpread(_objectSpread({},options.headers),{},{Authorization:\"Bearer \".concat(user===null||user===void 0?void 0:user.token),'Content-Type':'application/json'})})).then(response=>{if(response.status===401){// Token expirado o inv√°lido\nsetUser(null);// Forzar logout\nlocalStorage.removeItem('token');alert('Sesi√≥n expirada. Por favor, inicia sesi√≥n nuevamente.');return Promise.reject(new Error('Token expirado'));}return response;});};const decodificarBarcode=barcode=>{if(barcode.length!==13){setError('El c√≥digo debe tener exactamente 13 d√≠gitos');return null;}const plu=barcode.substring(2,7);const pesoStr=barcode.substring(7,12);const pesoGramos=parseInt(pesoStr,10);if(isNaN(pesoGramos)||pesoGramos<=0){setError('Peso inv√°lido en c√≥digo de barras');return null;}const producto=productos.find(p=>p.plu===plu);if(!producto){setError(\"No se encontr\\xF3 producto con PLU: \".concat(plu));return null;}return{producto,peso:pesoGramos};};// Agregar esta funci√≥n para filtrar unidades\nconst unidadesFiltradas=unidades.filter(unidad=>{const searchLower=filtroInventario.toLowerCase();const matchNombre=unidad.producto.nombre.toLowerCase().includes(searchLower);const matchPLU=unidad.producto.plu.includes(searchLower);const matchID=unidad.id.toString().includes(searchLower);// Si est√° activada la b√∫squeda por observaciones\nif(busquedaObservaciones&&unidad.observacionesIngreso){const matchObservaciones=unidad.observacionesIngreso.toLowerCase().includes(searchLower);return matchObservaciones;}return matchNombre||matchPLU||matchID;});// Agregar funci√≥n para contar unidades por producto\nconst contarUnidadesPorProducto=productoId=>{return unidades.filter(u=>u.producto.id===productoId&&u.activa).length;};// Agregar funci√≥n para editar unidad\nconst handleEditUnidad=async(unidadId,nuevasObservaciones)=>{try{const response=await apiFetch(\"\".concat(API_URL,\"/api/unidades/\").concat(unidadId),{method:'PUT',body:JSON.stringify({observacionesIngreso:nuevasObservaciones})});if(response.ok){setSuccess('Unidad actualizada correctamente');await fetchUnidades();setTimeout(()=>setSuccess(''),3000);}else{const errorData=await response.json();setError(errorData.error||'Error al actualizar unidad');}}catch(error){setError('Error de conexi√≥n con el servidor');}};// Funci√≥n para obtener el stock actual de un producto\nconst getStockActualProducto=productoId=>{return unidades.filter(u=>u.producto.id===productoId&&u.activa).length;};// Funci√≥n para calcular cu√°ntas unidades se agotaron de un producto\nconst getUnidadesAgotadasProducto=productoId=>{return historialUnidades.filter(u=>u.producto.id===productoId&&!u.activa).length;};// Funci√≥n para calcular el peso total vendido por producto\nconst getPesoVendidoProducto=productoId=>{return historialUnidades.filter(u=>u.producto.id===productoId&&!u.activa).reduce((sum,u)=>sum+Number(u.pesoInicial),0);};const handleBarcodeCorteChange=e=>{const value=e.target.value;setCodigoBarrasCorte(value);if(value.length===13&&unidadParaCortar){const resultado=decodificarBarcode(value);if(!resultado){setError('C√≥digo de barras inv√°lido');return;}const nuevoPeso=resultado.peso;const pesoActual=unidadParaCortar.pesoActual;if(nuevoPeso>pesoActual){setError('El peso escaneado es mayor al disponible');setPesoCorte('');return;}const corte=pesoActual-nuevoPeso;setPesoCorte(corte.toString());}};const handleBarcodeChange=e=>{const value=e.target.value;setCodigoBarras(value);setError('');setProductoSeleccionado(null);if(value.length===13){const resultado=decodificarBarcode(value);if(resultado){setProductoSeleccionado(resultado.producto);}}};const handleSubmit=async()=>{if(!motivoIngresoId){setError('Debe seleccionar un motivo de ingreso');return;}if(!codigoBarras||codigoBarras.length!==13){setError('Ingrese un c√≥digo de barras v√°lido de 13 d√≠gitos');return;}const resultado=decodificarBarcode(codigoBarras);if(!resultado)return;setLoading(true);setError('');try{const response=await apiFetch(\"\".concat(API_URL,\"/api/unidades\"),{method:'POST',body:JSON.stringify({productoId:resultado.producto.id,pesoInicial:resultado.peso,observacionesIngreso:observacionesIngreso||null,motivoId:motivoIngresoId||null})});if(response.ok){setSuccess('Unidad ingresada correctamente');setCodigoBarras('');setProductoSeleccionado(null);setObservacionesIngreso('');setShowForm(false);await fetchUnidades();setTimeout(()=>setSuccess(''),3000);}else{const errorData=await response.json();setError(errorData.error||'Error al ingresar unidad');}}catch(error){setError('Error de conexi√≥n con el servidor');}finally{setLoading(false);}};const handleOpenCutModal=unidad=>{setUnidadParaCortar(unidad);setPesoCorte('');setObservacionesCorte('');setShowCutModal(true);};const handleCut=async()=>{if(!unidadParaCortar){setError('No se seleccion√≥ unidad');return;}const peso=parseFloat(pesoCorte);if(isNaN(peso)||peso<0){setError('El peso debe ser 0 o mayor');return;}// Validar que haya suficiente peso\nif(peso>unidadParaCortar.pesoActual){setError(\"Peso insuficiente. Disponible: \".concat(unidadParaCortar.pesoActual,\"g\"));return;}setLoading(true);setError('');try{const response=await apiFetch(\"\".concat(API_URL,\"/api/unidades/\").concat(unidadParaCortar.id,\"/particiones\"),{method:'POST',body:JSON.stringify({peso:peso,observacionesCorte:observacionesCorte||'Corte sin observaciones',motivoId:motivoCorteId||null})});if(response.ok){const data=await response.json();setSuccess(\"Corte registrado: \".concat(peso,\"g\"));setShowCutModal(false);setCodigoBarrasCorte('');setPesoCorte('');setObservacionesCorte('');await fetchUnidades();}else{const errorData=await response.json();setError(errorData.error||'Error al registrar el corte');}}catch(error){setError('Error de conexi√≥n con el servidor');}finally{setLoading(false);}};const formatDate=dateString=>{return new Date(dateString).toLocaleDateString('es-AR',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});};const handleEgresoTotal=async()=>{if(!unidadParaCortar)return;const pesoTotal=unidadParaCortar.pesoActual;setLoading(true);setError('');try{const response=await apiFetch(\"\".concat(API_URL,\"/api/unidades/\").concat(unidadParaCortar.id,\"/particiones\"),{method:'POST',body:JSON.stringify({peso:pesoTotal,// ‚úÖ Enviamos el peso total directamente\nobservacionesCorte:'Corte final ‚Äì queso agotado',motivoId:motivoCorteId||null})});if(response.ok){setSuccess(\"Corte registrado: \".concat(pesoTotal,\"g\"));setShowCutModal(false);setCodigoBarrasCorte('');setPesoCorte('');setObservacionesCorte('');await fetchUnidades();}else{const errorData=await response.json();setError(errorData.error||'Error al registrar el corte');}}catch(error){setError('Error de conexi√≥n con el servidor');}finally{setLoading(false);}};const getTipoBadgeClass=tipo=>{const tipos={'blando':'badge-blando','semi-duro':'badge-semi-duro','duro':'badge-duro'};return tipos[tipo===null||tipo===void 0?void 0:tipo.toLowerCase()]||'badge-blando';};// Reemplazar la funci√≥n de filtrado del historial\nconst historialFiltrado=historialUnidades.filter(unidad=>{// Filtro por estado (activos/agotados/todos)\nif(filtroHistorial==='activos'&&!unidad.activa)return false;if(filtroHistorial==='agotados'&&unidad.activa)return false;// Filtro por tipo de queso\nif(tipoQuesoFiltro!=='todos'&&unidad.producto.tipoQueso.nombre.toLowerCase()!==tipoQuesoFiltro){return false;}// Filtro por fechas\nif(fechaInicio||fechaFin){const unidadFecha=new Date(unidad.createdAt);const inicio=fechaInicio?new Date(fechaInicio):null;const fin=fechaFin?new Date(fechaFin):null;if(inicio&&unidadFecha<inicio)return false;if(fin&&unidadFecha>fin)return false;}// Filtro por b√∫squeda de texto\nif(busquedaHistorial){var _unidad$observaciones;const searchLower=busquedaHistorial.toLowerCase();const matchNombre=unidad.producto.nombre.toLowerCase().includes(searchLower);const matchPLU=unidad.producto.plu.includes(searchLower);const matchID=unidad.id.toString().includes(searchLower);const matchObservaciones=(_unidad$observaciones=unidad.observacionesIngreso)===null||_unidad$observaciones===void 0?void 0:_unidad$observaciones.toLowerCase().includes(searchLower);return matchNombre||matchPLU||matchID||matchObservaciones;}return true;});// Calcular estad√≠sticas del historial con los nuevos filtros\nconst statsHistorial={total:historialFiltrado.length,activos:historialFiltrado.filter(u=>u.activa).length,agotados:historialFiltrado.filter(u=>!u.activa).length,pesoTotal:historialFiltrado.reduce((sum,u)=>sum+Number(u.pesoInicial),0),pesoVendido:historialFiltrado.reduce((sum,u)=>sum+(Number(u.pesoInicial)-Number(u.pesoActual)),0),productosDiferentes:new Set(historialFiltrado.map(u=>u.producto.id)).size};const statsAdicionales=React.useMemo(()=>{const agotadas=historialFiltrado.filter(u=>!u.activa);// productos m√°s vendidos (cantidad de unidades agotadas)\nconst productosMasVendidos=agotadas.reduce((acc,u)=>{const nombre=u.producto.nombre;acc[nombre]=(acc[nombre]||0)+1;return acc;},{});// peso total vendido por tipo de queso\nconst pesoPorTipo=agotadas.reduce((acc,u)=>{const tipo=u.producto.tipoQueso.nombre;acc[tipo]=(acc[tipo]||0)+Number(u.pesoInicial);return acc;},{});return{productosMasVendidos,pesoPorTipo};},[historialFiltrado]);const handleOpenHistorial=async()=>{setShowHistorial(true);await fetchHistorial();};if(!user)return/*#__PURE__*/_jsx(Login,{onLogin:setUser});// Modificar la funci√≥n renderUnidadCard para el historial\nconst renderUnidadCard=function(unidad){let isHistorial=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return/*#__PURE__*/_jsxs(\"div\",{className:\"unit-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"unit-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"unit-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"unit-title-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"badge \".concat(getTipoBadgeClass(unidad.producto.tipoQueso.nombre)),children:unidad.producto.tipoQueso.nombre}),/*#__PURE__*/_jsxs(\"span\",{className:\"badge badge-plu\",children:[\"PLU: \",unidad.producto.plu]}),/*#__PURE__*/_jsx(\"span\",{className:\"badge \".concat(unidad.activa?'badge-status':'badge-inactive'),children:unidad.activa?'Activa':'Agotada'}),unidad.motivo&&/*#__PURE__*/_jsxs(\"div\",{className:\"observaciones-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"observaciones-title\",children:\"Motivo de Ingreso\"}),/*#__PURE__*/_jsx(\"div\",{className:\"observaciones-content\",children:unidad.motivo.nombre})]}),isHistorial&&/*#__PURE__*/_jsxs(\"span\",{className:\"badge\",style:{background:'#e0e7ff',color:'#4338ca'},children:[\"Stock Actual: \",getStockActualProducto(unidad.producto.id)]}),!isHistorial&&unidad.activa&&/*#__PURE__*/_jsxs(\"span\",{className:\"badge\",style:{background:'#e0e7ff',color:'#4338ca'},children:[\"Stock: \",contarUnidadesPorProducto(unidad.producto.id)]})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"unit-name\",children:unidad.producto.nombre}),/*#__PURE__*/_jsxs(\"div\",{className:\"unit-id\",children:[\"ID: #\",unidad.id]}),isHistorial&&!unidad.activa&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'0.5rem',fontSize:'0.875rem',color:'#6b7280'},children:[\"Unidades agotadas: \",getUnidadesAgotadasProducto(unidad.producto.id),\" | Peso vendido: \",(getPesoVendidoProducto(unidad.producto.id)/1000).toFixed(1),\"kg\"]})]}),unidad.activa&&!isHistorial&&/*#__PURE__*/_jsx(\"div\",{className:\"unit-actions\",children:unidad.activa&&!isHistorial&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-action btn-cut\",onClick:()=>handleOpenCutModal(unidad),children:\"\\u2702\\uFE0F Cortar\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-action btn-edit\",onClick:()=>{setUnidadParaEditar(unidad);setShowEditModal(true);},children:\"\\u270F\\uFE0F Editar\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"unit-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"Peso Inicial\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-value\",children:[unidad.pesoInicial,\"g\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"Peso Actual\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-value highlight\",children:[unidad.pesoActual,\"g\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"Cortado\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-value\",children:[Number(unidad.pesoInicial)-Number(unidad.pesoActual),\"g\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"Ingresado\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",style:{fontSize:'0.875rem'},children:formatDate(unidad.createdAt)})]})]}),unidad.observacionesIngreso&&/*#__PURE__*/_jsxs(\"div\",{className:\"observaciones-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"observaciones-title\",children:\"Observaciones de Ingreso\"}),/*#__PURE__*/_jsx(\"div\",{className:\"observaciones-content\",children:unidad.observacionesIngreso})]}),unidad.particiones&&unidad.particiones.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"partitions-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"partitions-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"partitions-title\",children:\"Historial de Cortes\"}),/*#__PURE__*/_jsx(\"div\",{className:\"partitions-count\",children:unidad.particiones.length})]}),/*#__PURE__*/_jsx(\"div\",{className:\"partitions-list\",children:unidad.particiones.map((particion,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"partition-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"partition-number\",children:[\"Corte #\",idx+1]}),/*#__PURE__*/_jsxs(\"div\",{className:\"partition-weight\",children:[particion.peso,\"g\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"partition-date\",children:formatDate(particion.createdAt)}),particion.observacionesCorte&&/*#__PURE__*/_jsx(\"div\",{className:\"partition-observaciones\",children:particion.observacionesCorte})]},particion.id))})]})]},unidad.id);};// Agregar este componente antes del return principal\nconst EditModal=_ref2=>{let{unidad,onClose,onSave}=_ref2;const[observaciones,setObservaciones]=useState((unidad===null||unidad===void 0?void 0:unidad.observacionesIngreso)||'');if(!unidad)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"modal-title\",children:\"Editar Unidad\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-close\",onClick:onClose,children:\"\\u2715\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Producto\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-input\",value:unidad.producto.nombre,disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Observaciones de Ingreso\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"form-input\",value:observaciones,onChange:e=>setObservaciones(e.target.value),rows:4,placeholder:\"Ej: Lote #123, Vencimiento: 15/03, etc.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-cancel\",onClick:onClose,children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-confirm\",onClick:()=>onSave(observaciones),children:\"Guardar\"})]})]})});};return/*#__PURE__*/_jsxs(\"div\",{className:\"app\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-left\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-icon\",children:/*#__PURE__*/_jsxs(\"svg\",{width:\"32\",height:\"32\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"white\",strokeWidth:\"2\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M16.5 9.4l-9-5.19M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\"}),/*#__PURE__*/_jsx(\"polyline\",{points:\"3.29 7 12 12 20.71 7\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"12\",y1:\"22\",x2:\"12\",y2:\"12\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-title\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Stock de Quesos\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Las Tres Estrellas\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:unidades.filter(u=>u.activa).length}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"Activas\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-divider\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:productos.length}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"Productos\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem'},children:[/*#__PURE__*/_jsxs(\"button\",{className:\"btn-primary\",onClick:handleOpenHistorial,children:[/*#__PURE__*/_jsx(\"svg\",{width:\"20\",height:\"20\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M3 3v5h5M3 8a9 9 0 1 0 18 0A9 9 0 0 0 3 8z\"})}),\"Historial\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn-primary\",onClick:()=>setShowForm(!showForm),children:[/*#__PURE__*/_jsxs(\"svg\",{width:\"20\",height:\"20\",viewBox:\"0 0 24 24\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\"}),/*#__PURE__*/_jsx(\"circle\",{cx:\"12\",cy:\"13\",r:\"4\"})]}),showForm?'Cerrar':'Nuevo Ingreso']})]})]})}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-error\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"alert-icon\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"alert-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"alert-title\",children:\"Valida\"}),/*#__PURE__*/_jsx(\"div\",{children:error})]})]}),success&&/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-success\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"alert-icon\",children:\"\\u2713\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"alert-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"alert-title\",children:\"\\xC9xito\"}),/*#__PURE__*/_jsx(\"div\",{children:success})]})]}),showEditModal&&/*#__PURE__*/_jsx(EditModal,{unidad:unidadParaEditar,onClose:()=>{setShowEditModal(false);setUnidadParaEditar(null);},onSave:observaciones=>{if(unidadParaEditar){handleEditUnidad(unidadParaEditar.id,observaciones);setShowEditModal(false);setUnidadParaEditar(null);}}}),showHistorial&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:()=>setShowHistorial(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal historial-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"modal-title\",children:\"\\uD83D\\uDCCB Historial Completo\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-close\",onClick:()=>setShowHistorial(false),children:\"\\u2715\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"historial-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-card-value\",children:statsHistorial.total}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-card-label\",children:\"Total Unidades\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card stat-card-success\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-card-value\",children:statsHistorial.activos}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-card-label\",children:\"Activas\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card stat-card-inactive\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-card-value\",children:statsHistorial.agotados}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-card-label\",children:\"Agotadas\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card stat-card-primary\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card-value\",children:[(statsHistorial.pesoTotal/1000).toFixed(1),\"kg\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-card-label\",children:\"Peso Total\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card stat-card-warning\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card-value\",children:[(statsHistorial.pesoVendido/1000).toFixed(1),\"kg\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-card-label\",children:\"EGRESO TOTAL\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"historial-filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Rango de Fechas\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.5rem',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"form-input\",value:fechaInicio,onChange:e=>setFechaInicio(e.target.value),style:{flex:1}}),/*#__PURE__*/_jsx(\"span\",{children:\"hasta\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"form-input\",value:fechaFin,onChange:e=>setFechaFin(e.target.value),style:{flex:1}}),(fechaInicio||fechaFin)&&/*#__PURE__*/_jsx(\"button\",{className:\"btn-action\",onClick:()=>{setFechaInicio('');setFechaFin('');},style:{background:'#ef4444',color:'white',border:'none'},children:\"\\u2715\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Tipo de Queso\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:tipoQuesoFiltro,onChange:e=>setTipoQuesoFiltro(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"todos\",children:\"Todos los tipos\"}),/*#__PURE__*/_jsx(\"option\",{value:\"blando\",children:\"Blando\"}),/*#__PURE__*/_jsx(\"option\",{value:\"semi-duro\",children:\"Semi-duro\"}),/*#__PURE__*/_jsx(\"option\",{value:\"duro\",children:\"Duro\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"filter-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-input\",placeholder:\"\\uD83D\\uDD0D Buscar por nombre, PLU, ID o observaciones...\",value:busquedaHistorial,onChange:e=>setBusquedaHistorial(e.target.value)})}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-buttons\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"filter-btn \".concat(filtroHistorial==='todos'?'active':''),onClick:()=>setFiltroHistorial('todos'),children:[\"Todos (\",statsHistorial.total,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"filter-btn \".concat(filtroHistorial==='activos'?'active':''),onClick:()=>setFiltroHistorial('activos'),children:[\"Activos (\",statsHistorial.activos,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"filter-btn \".concat(filtroHistorial==='agotados'?'active':''),onClick:()=>setFiltroHistorial('agotados'),children:[\"Agotados (\",statsHistorial.agotados,\")\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"historial-content\",children:historialFiltrado.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"No se encontraron registros\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Intenta ajustar los filtros de b\\xFAsqueda\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"inventory-grid\",children:historialFiltrado.map(unidad=>renderUnidadCard(unidad,true))})})]})}),showForm&&/*#__PURE__*/_jsxs(\"div\",{className:\"card form-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Registrar Nueva Unidad\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"C\\xF3digo de Barras\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-input barcode-input\",value:codigoBarras,onChange:handleBarcodeChange,placeholder:\"0000000000000\",maxLength:13}),/*#__PURE__*/_jsx(\"div\",{className:\"form-hint\",children:\"Formato: 00 + PLU (5 d\\xEDgitos) + Peso (5 d\\xEDgitos) + 1 d\\xEDgito\"})]}),productoSeleccionado&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Producto Detectado\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-input\",value:productoSeleccionado.nombre,disabled:true}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-hint\",children:[\"Peso: \",((_decodificarBarcode=decodificarBarcode(codigoBarras))===null||_decodificarBarcode===void 0?void 0:_decodificarBarcode.peso)||0,\"g\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Observaciones de Ingreso (opcional)\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"form-input\",value:observacionesIngreso,onChange:e=>setObservacionesIngreso(e.target.value),placeholder:\"Ej: Lote #123, Vencimiento: 15/03, etc.\",rows:3})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Motivo de Ingreso *\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:motivoIngresoId||'',onChange:e=>setMotivoIngresoId(Number(e.target.value)),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"-- Seleccionar motivo --\"}),motivos.map(m=>/*#__PURE__*/_jsx(\"option\",{value:m.id,children:m.nombre},m.id))]})]})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-submit\",onClick:handleSubmit,disabled:loading||!productoSeleccionado,children:loading?'Procesando...':'Registrar Unidad'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Inventario Actual\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",style:{marginBottom:'1.5rem'},children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Buscar en inventario\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.5rem',alignItems:'flex-end'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-input\",value:filtroInventario,onChange:e=>setFiltroInventario(e.target.value),placeholder:\"Buscar por nombre, PLU o ID...\",style:{flex:1}}),/*#__PURE__*/_jsx(\"button\",{className:\"filter-btn \".concat(busquedaObservaciones?'active':''),onClick:()=>setBusquedaObservaciones(!busquedaObservaciones),style:{marginBottom:0},children:\"\\uD83D\\uDD0D Observaciones\"})]})]}),unidadesFiltradas.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"No se encontraron unidades\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Intenta ajustar los filtros de b\\xFAsqueda\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"inventory-grid\",children:unidadesFiltradas.map(unidad=>renderUnidadCard(unidad))})]}),showCutModal&&unidadParaCortar&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:()=>setShowCutModal(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"modal-title\",children:\"Realizar Corte\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-close\",onClick:()=>setShowCutModal(false),children:\"\\u2715\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Producto\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-input\",value:unidadParaCortar.producto.nombre,disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Peso Disponible\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-input\",value:\"\".concat(unidadParaCortar.pesoActual,\"g\"),disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Escanear c\\xF3digo de barras del queso despu\\xE9s del corte\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-input barcode-input\",value:codigoBarrasCorte,onChange:handleBarcodeCorteChange,placeholder:\"0000000000000\",maxLength:13}),/*#__PURE__*/_jsx(\"div\",{className:\"form-hint\",children:\"Escane\\xE1 el c\\xF3digo del queso que qued\\xF3. Se calcular\\xE1 autom\\xE1ticamente cu\\xE1nto se cort\\xF3.\"})]}),pesoCorte&&/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Peso a cortar (calculado)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-input\",value:\"\".concat(pesoCorte,\"g\"),disabled:true})]}),unidadParaCortar.pesoActual>0&&/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"btn-action btn-cut\",onClick:()=>{// üéØ Egreso directo sin validaciones\nhandleEgresoTotal();},children:[\"\\uD83E\\uDDC0 Egresar todo (\",unidadParaCortar.pesoActual,\"g)\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Observaciones del corte (opcional)\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"form-input\",value:observacionesCorte,onChange:e=>setObservacionesCorte(e.target.value),placeholder:\"Ej: Cliente: Juan P\\xE9rez, Pedido especial, etc.\",rows:3})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Motivo del corte *\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:motivoCorteId||'',onChange:e=>setMotivoCorteId(Number(e.target.value)),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"-- Seleccionar motivo --\"}),motivos.map(m=>/*#__PURE__*/_jsx(\"option\",{value:m.id,children:m.nombre},m.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-cancel\",onClick:()=>setShowCutModal(false),children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-confirm\",onClick:handleCut,disabled:loading||!pesoCorte,children:loading?'Procesando...':'Confirmar Corte'})]})]})})]});}export default App;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}